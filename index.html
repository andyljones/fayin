<html>
<head>
<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
<script>

TARGET = "Initial target";
TRANSCRIPT = "Initial transcript";
FINALIZED = false;

function update_text() {
    const is_finalized = FINALIZED? "finalized" : "unfinalized" 

    const common_len = Math.min(TARGET.length, TRANSCRIPT.length);
    var target = [];
    var transcript = [];
    for (var i=0; i < common_len; i++) {
        var cls = TARGET[i] == TRANSCRIPT[i]? 'correct' : 'error';
        target.push($('<span/>').addClass(cls).html(TARGET[i]));
        transcript.push($('<span/>').addClass(cls).addClass(is_finalized).html(TRANSCRIPT[i]));
    }

    for (var i=common_len; i < TARGET.length; i++) {
        target.push($('<span/>').addClass('unseen').html(TARGET[i]));
    }

    for (var i=common_len; i < TRANSCRIPT.length; i++) {
        transcript.push($('<span/>').addClass('error').addClass(is_finalized).html(TRANSCRIPT[i]));
    }

    $("#target").html(target);
    $("#transcript").html(transcript);
}

function pick_target() {
    TARGET = "你好你是什么";
    TRANSCRIPT = "";
    update_text();
}

function handle_recognition(event) {
    var result = event.results[event.results.length-1]
    TRANSCRIPT = result[0].transcript;
    FINALIZED = result.isFinal;
    update_text()
}

function start_recogniser() {
    var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
    var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList;
    var SpeechRecognitionEvent = SpeechRecognitionEvent || webkitSpeechRecognitionEvent;

    var recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = "zh-CN";
    recognition.onresult = handle_recognition;

    recognition.start();
}

$(document).ready(() => {
    pick_target();
    start_recogniser();
});

</script>

<style>
    #contents {
        display: block; 
        margin: auto;
        width: 800px;
        border: 1px solid black;
        font-size: x-large;
    }

    #contents p {
        margin: 10px;
        height: 1.5em;
    }

    .correct {
        color: green;
    }

    .unfinalized {
        opacity: .5;
    }

    .finalized {
        opacity: 1.;
    }

    .error {
        color: red;
    }
</style>

</head>
<body>
    <div id="contents">
        <p id="target"> </p>
        <p id="transcript"> </p>
    </div>
</body>

</html>